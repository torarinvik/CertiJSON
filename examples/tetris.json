{
  "module": "Tetris",
  "imports": ["Raylib", "Std.IO", "Std.Math", "Std.Memory"],
  "declarations": [
    {
      "def": {
        "name": "create_grid",
        "role": "runtime",
        "type": { "app": [{ "var": "IO" }, { "var": "VoidPtr" }] },
        "body": {
          "app": [
            { "var": "bind" },
            { "var": "VoidPtr" },
            { "var": "VoidPtr" },
            {
              "app": [
                { "var": "calloc" },
                { "int64": 200 },
                { "int64": 4 }
              ]
            },
            {
              "lambda": {
                "arg": { "name": "p", "type": { "var": "VoidPtr" } },
                "body": {
                  "app": [
                    { "var": "return" },
                    { "var": "VoidPtr" },
                    { "var": "p" }
                  ]
                }
              }
            }
          ]
        }
      }
    },
    {
      "def": {
        "name": "get_grid",
        "role": "runtime",
        "type": {
          "pi": {
            "arg": { "name": "g", "type": { "var": "VoidPtr" } },
            "result": {
              "pi": {
                "arg": { "name": "i", "type": { "prim": "Int32" } },
                "result": { "app": [{ "var": "IO" }, { "prim": "Int32" }] }
              }
            }
          }
        },
        "body": {
          "lambda": {
            "arg": { "name": "g", "type": { "var": "VoidPtr" } },
            "body": {
              "lambda": {
                "arg": { "name": "i", "type": { "prim": "Int32" } },
                "body": {
                  "if": {
                    "cond": { "app": [ { "var": "lt" }, { "var": "i" }, { "int32": 0 } ] },
                    "then": { "app": [ { "var": "return" }, { "prim": "Int32" }, { "int32": 0 } ] },
                    "else": {
                      "if": {
                        "cond": { "app": [ { "var": "gt" }, { "var": "i" }, { "int32": 199 } ] },
                        "then": { "app": [ { "var": "return" }, { "prim": "Int32" }, { "int32": 0 } ] },
                        "else": {
                          "app": [
                            { "var": "bind" },
                            { "prim": "Int32" },
                            { "prim": "Int32" },
                            {
                              "app": [
                                { "var": "load_int32" },
                                {
                                  "app": [
                                    { "var": "ptr_offset" },
                                    { "var": "g" },
                                    { "app": [ { "var": "mul" }, { "var": "i" }, { "int32": 4 } ] }
                                  ]
                                }
                              ]
                            },
                            {
                              "lambda": {
                                "arg": { "name": "v", "type": { "prim": "Int32" } },
                                "body": {
                                  "app": [
                                    { "var": "return" },
                                    { "prim": "Int32" },
                                    { "var": "v" }
                                  ]
                                }
                              }
                            }
                          ]
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "def": {
        "name": "set_grid",
        "role": "runtime",
        "type": {
          "pi": {
            "arg": { "name": "g", "type": { "var": "VoidPtr" } },
            "result": {
              "pi": {
                "arg": { "name": "i", "type": { "prim": "Int32" } },
                "result": {
                  "pi": {
                    "arg": { "name": "v", "type": { "prim": "Int32" } },
                    "result": { "app": [ { "var": "IO" }, { "var": "Unit" } ] }
                  }
                }
              }
            }
          }
        },
        "body": {
          "lambda": {
            "arg": { "name": "g", "type": { "var": "VoidPtr" } },
            "body": {
              "lambda": {
                "arg": { "name": "i", "type": { "prim": "Int32" } },
                "body": {
                  "lambda": {
                    "arg": { "name": "v", "type": { "prim": "Int32" } },
                    "body": {
                      "if": {
                        "cond": {
                          "app": [
                            { "var": "lt" },
                            { "var": "i" },
                            { "int32": 0 }
                          ]
                        },
                        "then": { "app": [ { "var": "return" }, { "var": "Unit" }, { "var": "tt" } ] },
                        "else": {
                          "if": {
                            "cond": { "app": [ { "var": "gt" }, { "var": "i" }, { "int32": 199 } ] },
                            "then": { "app": [ { "var": "return" }, { "var": "Unit" }, { "var": "tt" } ] },
                            "else": {
                              "app": [
                                { "var": "store_int32" },
                                {
                                  "app": [
                                    { "var": "ptr_offset" },
                                    { "var": "g" },
                                    { "app": [ { "var": "mul" }, { "var": "i" }, { "int32": 4 } ] }
                                  ]
                                },
                                { "var": "v" }
                              ]
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "def": {
        "name": "init_rand",
        "role": "runtime",
        "type": { "app": [ { "var": "IO" }, { "var": "Unit" } ] },
        "body": { "app": [ { "var": "srand" }, { "int32": 42 } ] }
      }
    },
    {
      "def": {
        "name": "random_int",
        "role": "runtime",
        "type": {
          "pi": {
            "arg": { "name": "min", "type": { "prim": "Int32" } },
            "result": {
              "pi": {
                "arg": { "name": "max", "type": { "prim": "Int32" } },
                "result": { "app": [ { "var": "IO" }, { "prim": "Int32" } ] }
              }
            }
          }
        },
        "body": {
          "lambda": {
            "arg": { "name": "min", "type": { "prim": "Int32" } },
            "body": {
              "lambda": {
                "arg": { "name": "max", "type": { "prim": "Int32" } },
                "body": {
                  "app": [
                    { "var": "bind" },
                    { "prim": "Int32" },
                    { "prim": "Int32" },
                    { "var": "rand" },
                    {
                      "lambda": {
                        "arg": { "name": "r", "type": { "prim": "Int32" } },
                        "body": {
                          "app": [
                            { "var": "return" },
                            { "prim": "Int32" },
                            {
                              "app": [
                                { "var": "add" },
                                { "var": "min" },
                                {
                                  "app": [
                                    { "var": "sub" },
                                    { "var": "r" },
                                    {
                                      "app": [
                                        { "var": "mul" },
                                        {
                                          "app": [
                                            { "var": "div" },
                                            { "var": "r" },
                                            {
                                              "app": [
                                                { "var": "add" },
                                                { "app": [ { "var": "sub" }, { "var": "max" }, { "var": "min" } ] },
                                                { "int32": 1 }
                                              ]
                                            }
                                          ]
                                        },
                                        {
                                          "app": [
                                            { "var": "add" },
                                            { "app": [ { "var": "sub" }, { "var": "max" }, { "var": "min" } ] },
                                            { "int32": 1 }
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      }
                    }
                  ]
                }
              }
            }
          }
        }
      }
    },
    {
      "def": {
        "name": "get_color_hex",
        "type": {
          "pi": {
            "arg": {"name": "i", "type": {"prim": "Int32"}},
            "result": {"prim": "Int32"}
          }
        },
        "body": {
          "lambda": {
            "arg": {"name": "i", "type": {"prim": "Int32"}},
            "body": {
              "if": {
                "cond": {"app": [{"var": "eq"}, {"var": "i"}, {"int32": 1}]},
                "then": {"int32": -16776961},
                "else": {
                  "if": {
                    "cond": {"app": [{"var": "eq"}, {"var": "i"}, {"int32": 2}]},
                    "then": {"int32": 16711935},
                    "else": {
                      "if": {
                        "cond": {"app": [{"var": "eq"}, {"var": "i"}, {"int32": 3}]},
                        "then": {"int32": 65535},
                        "else": {
                          "if": {
                            "cond": {"app": [{"var": "eq"}, {"var": "i"}, {"int32": 4}]},
                            "then": {"int32": -256},
                            "else": {
                              "if": {
                                "cond": {"app": [{"var": "eq"}, {"var": "i"}, {"int32": 5}]},
                                "then": {"int32": -65281},
                                "else": {
                                  "if": {
                                    "cond": {"app": [{"var": "eq"}, {"var": "i"}, {"int32": 6}]},
                                    "then": {"int32": -5963521},
                                    "else": {
                                      "if": {
                                        "cond": {"app": [{"var": "eq"}, {"var": "i"}, {"int32": 7}]},
                                        "then": {"int32": 1431655935},
                                        "else": {"int32": 255}
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "def": {
        "name": "draw_block",
        "type": {
          "pi": {
            "arg": {"name": "x", "type": {"prim": "Int32"}},
            "result": {
              "pi": {
                "arg": {"name": "y", "type": {"prim": "Int32"}},
                "result": {
                  "pi": {
                    "arg": {"name": "c", "type": {"prim": "Int32"}},
                    "result": {"app": [{"var": "IO"}, {"var": "Unit"}]}
                  }
                }
              }
            }
          }
        },
        "body": {
          "lambda": {
            "arg": {"name": "x", "type": {"prim": "Int32"}},
            "body": {
              "lambda": {
                "arg": {"name": "y", "type": {"prim": "Int32"}},
                "body": {
                  "lambda": {
                    "arg": {"name": "c", "type": {"prim": "Int32"}},
                    "body": {
                      "app": [
                        {"var": "DrawRectangle"},
                        {"app": [{"var": "mul"}, {"var": "x"}, {"int32": 40}]},
                        {"app": [{"var": "mul"}, {"var": "y"}, {"int32": 40}]},
                        {"int32": 38},
                        {"int32": 38},
                        {"app": [{"var": "GetColor"}, {"app": [{"var": "get_color_hex"}, {"var": "c"}]}]}
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "def": {
        "name": "draw_grid",
        "type": {
          "pi": {
            "arg": {"name": "g", "type": {"var": "VoidPtr"}},
            "result": {"app": [{"var": "IO"}, {"var": "Unit"}]}
          }
        },
        "body": {
          "lambda": {
            "arg": {"name": "g", "type": {"var": "VoidPtr"}},
            "body": {
              "app": [
                {"var": "return"},
                {"var": "Unit"},
                {"var": "tt"}
              ]
            }
          }
        }
      }
    },
    {
      "def": {
        "name": "loop",
        "role": "runtime",
        "type": {
          "pi": {
            "arg": {"name": "grid", "type": {"var": "VoidPtr"}},
            "result": {
              "pi": {
                "arg": {"name": "px", "type": {"prim": "Int32"}},
                "result": {
                  "pi": {
                    "arg": {"name": "py", "type": {"prim": "Int32"}},
                    "result": {
                      "pi": {
                        "arg": {"name": "ptype", "type": {"prim": "Int32"}},
                        "result": {
                          "pi": {
                            "arg": {"name": "timer", "type": {"prim": "Int32"}},
                            "result": {"app": [{"var": "IO"}, {"var": "Unit"}]}
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "body": {
          "lambda": {
            "arg": {"name": "grid", "type": {"var": "VoidPtr"}},
            "body": {
              "lambda": {
                "arg": {"name": "px", "type": {"prim": "Int32"}},
                "body": {
                  "lambda": {
                    "arg": {"name": "py", "type": {"prim": "Int32"}},
                    "body": {
                      "lambda": {
                        "arg": {"name": "ptype", "type": {"prim": "Int32"}},
                        "body": {
                          "lambda": {
                            "arg": {"name": "timer", "type": {"prim": "Int32"}},
                            "body": {
                              "app": [
                                {"var": "bind"},
                                {"prim": "Bool"},
                                {"var": "Unit"},
                                {"app": [{"var": "WindowShouldClose"}, {"var": "tt"}]},
                                {
                                  "lambda": {
                                    "arg": {"name": "should_close", "type": {"prim": "Bool"}},
                                    "body": {
                                      "if": {
                                        "cond": {"var": "should_close"},
                                        "then": {"app": [{"var": "return"}, {"var": "Unit"}, {"var": "tt"}]},
                                        "else": {
                                          "app": [
                                            {"var": "bind"},
                                            {"var": "Unit"},
                                            {"var": "Unit"},
                                            {"app": [{"var": "BeginDrawing"}, {"var": "tt"}]},
                                            {
                                              "lambda": {
                                                "arg": {"name": "_", "type": {"var": "Unit"}},
                                                "body": {
                                                  "app": [
                                                    {"var": "bind"},
                                                    {"var": "Unit"},
                                                    {"var": "Unit"},
                                                    {"app": [{"var": "ClearBackground"}, {"app": [{"var": "GetColor"}, {"int32": 255}]}]},
                                                    {
                                                      "lambda": {
                                                        "arg": {"name": "_", "type": {"var": "Unit"}},
                                                        "body": {
                                                          "app": [
                                                            {"var": "bind"},
                                                            {"var": "Unit"},
                                                            {"var": "Unit"},
                                                            {"app": [{"var": "draw_grid"}, {"var": "grid"}]},
                                                            {
                                                              "lambda": {
                                                                "arg": {"name": "_", "type": {"var": "Unit"}},
                                                                "body": {
                                                                  "app": [
                                                                    {"var": "bind"},
                                                                    {"var": "Unit"},
                                                                    {"var": "Unit"},
                                                                    {"app": [{"var": "draw_block"}, {"var": "px"}, {"var": "py"}, {"var": "ptype"}]},
                                                                    {
                                                                      "lambda": {
                                                                        "arg": {"name": "_", "type": {"var": "Unit"}},
                                                                        "body": {
                                                                          "app": [
                                                                            {"var": "bind"},
                                                                            {"var": "Unit"},
                                                                            {"var": "Unit"},
                                                                            {"app": [{"var": "EndDrawing"}, {"var": "tt"}]},
                                                                            {
                                                                              "lambda": {
                                                                                "arg": {"name": "_", "type": {"var": "Unit"}},
                                                                                "body": {
                                                                                  "app": [
                                                                                    {"var": "loop"},
                                                                                    {"var": "grid"},
                                                                                    {"var": "px"},
                                                                                    {
                                                                                      "if": {
                                                                                        "cond": {"app": [{"var": "gt"}, {"var": "timer"}, {"int32": 30}]},
                                                                                        "then": {"app": [{"var": "add"}, {"var": "py"}, {"int32": 1}]},
                                                                                        "else": {"var": "py"}
                                                                                      }
                                                                                    },
                                                                                    {"var": "ptype"},
                                                                                    {
                                                                                      "if": {
                                                                                        "cond": {"app": [{"var": "gt"}, {"var": "timer"}, {"int32": 30}]},
                                                                                        "then": {"int32": 0},
                                                                                        "else": {"app": [{"var": "add"}, {"var": "timer"}, {"int32": 1}]}
                                                                                      }
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              }
                                                                            }
                                                                          ]
                                                                        }
                                                                      }
                                                                    }
                                                                  ]
                                                                }
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    }
                                                  ]
                                                }
                                              }
                                            }
                                          ]
                                        }
                                      }
                                    }
                                  }
                                }
                              ]
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "rec_args": [0]
      }
    },
    {
      "def": {
        "name": "main",
        "role": "runtime",
        "type": {"app": [{"var": "IO"}, {"var": "Unit"}]},
        "body": {
          "app": [
            {"var": "bind"},
            {"var": "Unit"},
            {"var": "Unit"},
            {"app": [{"var": "InitWindow"}, {"int32": 400}, {"int32": 800}, {"string": "CertiJSON Tetris"}]},
            {
              "lambda": {
                "arg": {"name": "_", "type": {"var": "Unit"}},
                "body": {
                  "app": [
                    {"var": "bind"},
                    {"var": "Unit"},
                    {"var": "Unit"},
                    {"app": [{"var": "SetTargetFPS"}, {"int32": 60}]},
                    {
                      "lambda": {
                        "arg": {"name": "_", "type": {"var": "Unit"}},
                        "body": {
                          "app": [
                            {"var": "bind"},
                            {"var": "Unit"},
                            {"var": "Unit"},
                            {"var": "init_rand"},
                            {
                              "lambda": {
                                "arg": {"name": "_", "type": {"var": "Unit"}},
                                "body": {
                                  "app": [
                                    {"var": "bind"},
                                    {"var": "VoidPtr"},
                                    {"var": "Unit"},
                                    {"var": "create_grid"},
                                    {
                                      "lambda": {
                                        "arg": {"name": "grid", "type": {"var": "VoidPtr"}},
                                        "body": {
                                          "app": [
                                            {"var": "loop"},
                                            {"var": "grid"},
                                            {"int32": 4},
                                            {"int32": 0},
                                            {"int32": 1},
                                            {"int32": 0}
                                          ]
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          ]
                        }
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  ]
}
