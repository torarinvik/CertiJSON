{
  "module": "Std.SafeMemory",
  "imports": ["Std.Nat", "Std.IO", "Std.Int"],
  "declarations": [
    {
      "repr": {
        "name": "VoidPtr",
        "kind": "primitive",
        "c_type": "void*",
        "size_bits": 64,
        "signed": false
      }
    },
    {
      "repr": {
        "name": "SizeT",
        "kind": "primitive",
        "c_type": "size_t",
        "size_bits": 64,
        "signed": false
      }
    },
    {
      "inductive": {
        "name": "ArrayHandle",
        "params": [
          { "name": "A", "type": { "universe": "Type" } },
          { "name": "n", "type": { "prim": "Int64" } }
        ],
        "universe": "Type",
        "constructors": []
      }
    },
    {
      "inductive": {
        "name": "ArrayView",
        "params": [
          { "name": "A", "type": { "universe": "Type" } },
          { "name": "n", "type": { "prim": "Int64" } }
        ],
        "universe": "Type",
        "constructors": []
      }
    },
    {
      "extern_io": {
        "name": "stack_alloc",
        "c_name": "cj_stack_alloc",
        "header": "<certijson_memory.h>",
        "signature": {
          "args": [
            { "name": "n", "repr": "SizeT" },
            { "name": "callback", "repr": "VoidPtr" }
          ],
          "result": { "repr": "VoidPtr" }
        },
        "type": {
          "forall": {
            "arg": { "name": "A", "type": { "universe": "Type" } },
            "result": {
              "forall": {
                "arg": { "name": "n", "type": { "prim": "Int64" } },
                "result": {
                  "forall": {
                    "arg": { "name": "B", "type": { "universe": "Type" } },
                    "result": {
                      "pi": {
                        "arg": {
                          "name": "callback",
                          "type": {
                            "pi": {
                              "arg": { "name": "h", "type": { "app": [{ "var": "ArrayHandle" }, { "var": "A" }, { "var": "n" }] } },
                              "result": { "app": [{ "var": "IO" }, { "var": "B" }] }
                            }
                          }
                        },
                        "result": { "app": [{ "var": "IO" }, { "var": "B" }] }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "extern_io": {
        "name": "as_view",
        "c_name": "cj_as_view",
        "header": "<certijson_memory.h>",
        "signature": {
          "args": [
            { "name": "handle", "repr": "VoidPtr" },
            { "name": "callback", "repr": "VoidPtr" }
          ],
          "result": { "repr": "VoidPtr" }
        },
        "type": {
          "forall": {
            "arg": { "name": "A", "type": { "universe": "Type" } },
            "result": {
              "forall": {
                "arg": { "name": "n", "type": { "prim": "Int64" } },
                "result": {
                  "forall": {
                    "arg": { "name": "B", "type": { "universe": "Type" } },
                    "result": {
                      "pi": {
                        "arg": { "name": "handle", "type": { "app": [{ "var": "ArrayHandle" }, { "var": "A" }, { "var": "n" }] } },
                        "result": {
                          "pi": {
                            "arg": {
                              "name": "callback",
                              "type": {
                                "pi": {
                                  "arg": { "name": "view", "type": { "app": [{ "var": "ArrayView" }, { "var": "A" }, { "var": "n" }] } },
                                  "result": { "app": [{ "var": "IO" }, { "var": "B" }] }
                                }
                              }
                            },
                            "result": {
                              "app": [
                                { "var": "IO" },
                                { "app": [{ "var": "Pair" }, { "app": [{ "var": "ArrayHandle" }, { "var": "A" }, { "var": "n" }] }, { "var": "B" }] }
                              ]
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "extern_io": {
        "name": "view_get_int32",
        "c_name": "cj_view_get_int32",
        "header": "<certijson_memory.h>",
        "signature": {
          "args": [
            { "name": "view", "repr": "VoidPtr" },
            { "name": "idx", "repr": "Int64" }
          ],
          "result": { "repr": "Int32" }
        },
        "type": {
          "forall": {
            "arg": { "name": "n", "type": { "prim": "Int64" } },
            "result": {
              "pi": {
                "arg": { "name": "view", "type": { "app": [{ "var": "ArrayView" }, { "prim": "Int32" }, { "var": "n" }] } },
                "result": {
                  "pi": {
                    "arg": { "name": "idx", "type": { "prim": "Int64" } },
                    "result": { "app": [{ "var": "IO" }, { "prim": "Int32" }] }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "extern_io": {
        "name": "view_set_int32",
        "c_name": "cj_view_set_int32",
        "header": "<certijson_memory.h>",
        "signature": {
          "args": [
            { "name": "view", "repr": "VoidPtr" },
            { "name": "idx", "repr": "Int64" },
            { "name": "val", "repr": "Int32" }
          ],
          "result": null
        },
        "type": {
          "forall": {
            "arg": { "name": "n", "type": { "prim": "Int64" } },
            "result": {
              "pi": {
                "arg": { "name": "view", "type": { "app": [{ "var": "ArrayView" }, { "prim": "Int32" }, { "var": "n" }] } },
                "result": {
                  "pi": {
                    "arg": { "name": "idx", "type": { "prim": "Int64" } },
                    "result": {
                      "pi": {
                        "arg": { "name": "val", "type": { "prim": "Int32" } },
                        "result": { "app": [{ "var": "IO" }, { "var": "Unit" }] }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "extern_c": {
        "name": "to_int64",
        "c_name": "cj_int32_to_int64",
        "header": "<certijson_memory.h>",
        "signature": {
          "args": [{ "name": "x", "repr": "Int32" }],
          "return": { "repr": "Int64" }
        },
        "type": {
          "pi": {
            "arg": { "name": "x", "type": { "prim": "Int32" } },
            "result": { "prim": "Int64" }
          }
        }
      }
    }
  ]
}
